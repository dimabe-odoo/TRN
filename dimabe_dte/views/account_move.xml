<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="account_move_form_inherit" model="ir.ui.view">
            <field name="name">account_move.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="l10n_latam_invoice_document.view_move_form"/>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_line_ids']/tree//field[@name='discount']" position="attributes">
                    <attribute name="digits">"[0, 0]"</attribute>
                </xpath>
                <xpath expr="//field[@name='invoice_line_ids']/form//field[@name='discount']" position="attributes">
                    <attribute name="widget">integer</attribute>
                </xpath>
                <xpath expr="//field[@name='l10n_latam_document_number']" position="attributes">
                    <attribute name="attrs">{
                        'invisible': [('state', '!=', 'draft'), ('is_jump_number', '!=', False)]}
                    </attribute>
                    <attribute name="groups">base.group_no_one</attribute>
                </xpath>
                <xpath expr="//header" position="inside">
                    <button type="object" name="button_verify_claim_dte_events" string="Verificar"/>
                </xpath>
                <xpath expr="//field[@name='payment_reference']" position="after">
                    <field name="invoice_payment_term_id"/>
                    <field name="document_number" attrs="{'invisible':[('is_jump_number','!=',True)]}"
                           groups="base.group_no_one"/>
                </xpath>
                <xpath expr="//field[@name='l10n_latam_document_number']" position="after">
                    <field name="is_jump_number" attrs="{'invisible':[('move_type','=','entry')]}"/>
                    <field name="document_number" attrs="{'invisible':[('is_jump_number','=',False)]}"/>
                </xpath>
                <xpath expr="//field[@name='invoice_payment_term_id']" position="after">
                    <field name="uf_date" attrs="{'readonly':[('state','!=','draft')],'invisible':[('move_type','!=','out_invoice')]}"/>
                    <field name="uf_value" attrs="{'readonly':[('state','!=','draft')],'invisible':[('move_type','!=','out_invoice')]}"/>
                </xpath>
            </field>
        </record>

        <record id="account_out_tree_view" model="ir.ui.view">
            <field name="name">Listado de Facturas</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="l10n_cl_dte_acceptation_status"/>
                    <field name="l10n_cl_dte_status"/>
                    <field name="state_send_email_dte" widget="badge"
                           decoration-success="state_send_email_dte == 'sent'"
                           decoration-danger="state_send_email_dte == 'exception'"/>
                </xpath>
            </field>
        </record>

        <record id="view_invoice_form_inherit" model="ir.ui.view">
            <field name="name">account.move.edi.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="l10n_cl_edi.view_invoice_form"/>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='electronic_invoice']" position="inside">
                    <group>
                        <field name="email_sended_ids">
                            <tree decoration-danger="state == 'exception'" decoration-success="state == 'sent'">
                                <field name="create_date" readonly="1"/>
                                <field name="state" readonly="1"/>
                                <field name="email_to" string="Para" readonly="1"/>
                                <field name="failure_reason" readonly="1"/>
                                <button string="Re enviar" name="mark_outgoing" type="object"
                                        attrs="{'invisible': [('state','!=','exception')]}"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="sii_code_response" invisible="1"/>
                        <field name="sii_last_event_dte"
                               attrs="{'invisible': ['|',('sii_code_response','=',16),('sii_code_response','=',False)]}"/>
                        <field name="invoice_event_ids" attrs="{'invisible': ['|',('sii_code_response','=',16),('sii_code_response','=',False)]}">
                            <tree editable="bottom" create="false" delete="false">
                                <field name="event_code" readonly="1"/>
                                <field name="event_description" readonly="1"/>
                                <field name="rut_accountable" readonly="1"/>
                                <field name="event_date" readonly="1"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="state_send_email_dte"/>
                    </group>

                </xpath>
                <xpath expr="//field[@name='l10n_cl_reference_ids']" position="before">
                    <button type="object" name="update_cl_reference" string="Actualizar Referencias" attrs="{'invisible':[('state','!=','draft')]}"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>